angular.module("ng-GoogleMap",[]).factory("ng-GoogleMapServices",["$injector",function(){var n={};return n.getObject=function(n,t,i){var u={},r;return(u[t]=i,r=cFilter("filter")(n,u,!0),r&&r[0]&&angular.isObject(r[0])&&!angular.isArray(r[0]))?r[0]:null},n}]).directive("ngGoogleMap",["ng-GoogleMapServices","$injector","$timeout",function(){return{restrict:"A",scope:{googleMapModel:"=googleMapModel"},link:function(n,t){function h(){try{u=new google.maps.Map(o,{zoom:12,center:{lat:62.3713,lng:15.4825},mapTypeId:google.maps.MapTypeId.HYBRID});i.enableInput&&b()}catch(n){alert(n);return}}function c(){var u;if(i&&i.mapData&&i.mapData.length>0){g();d();var f=new google.maps.LatLngBounds,n=null,r=0,t=[];for(u=0;u<i.mapData.length;u++){if(n=i.mapData[u],n&&n.values&&n.values.length>0){for(t=[],r=0;r<n.values.length;r++)t.push(new google.maps.LatLng(n.values[r][0]*1,n.values[r][1]*1));t.length>0&&f.extend(t[t.length-1])}s(t,n)}}}function s(n,t){var r=w();return t||(t={}),t.guid=r,i.polygons.push(new google.maps.Polygon({id:r,paths:n,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,userData:t})),i.polygons[i.polygons.length-1].setMap(u),r}function l(){}function a(){}function v(){}function y(){}function p(){try{google.maps.Polygon.prototype.my_getBounds=function(){var n=new google.maps.LatLngBounds;return this.getPath().forEach(function(t){n.extend(t)}),n}}catch(n){alert(n);return}}function w(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function b(){r=document.createElement("input");r.type="text";r.placeholder="";r.className="ng-google-map-input-control";e=new google.maps.places.SearchBox(r);u.controls[google.maps.ControlPosition.TOP_LEFT].push(r);k()}function k(){u.addListener("bounds_changed",function(){e.setBounds(u.getBounds())});var n=[];angular.element(r).bind("keyup",function(n){n.keyCode==13&&(google.maps.event.trigger(r,"focus"),google.maps.event.trigger(r,"keydown",{keyCode:13}))});e.addListener("places_changed",function(){var i=e.getPlaces(),t;i.length!=0&&(n.forEach(function(n){n.setMap(null)}),n=[],t=new google.maps.LatLngBounds,i.forEach(function(n){if(!n.geometry){console.error("Returned place contains no geometry");return}n.geometry.viewport?t.union(n.geometry.viewport):t.extend(n.geometry.location)}),u.fitBounds(t))})}function d(){if(!i.infoWindow)return!1;i.infoWindow.close();i.infoWindow=new google.maps.InfoWindow}function g(){if(i.polygons&&i.polygons&&i.polygons.length>0){for(var n=0;n<i.polygons.length;n++)i.polygons[n].setMap(null);i.polygons=[]}}function nt(n){f&&f.setMap(null);f=new google.maps.drawing.DrawingManager({drawingControl:!0,polylineOptions:{editable:!1},drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON,]},userData:n});f.setMap(u);google.maps.event.addListener(f,"overlaycomplete",function(n){var r,o,h;var e=this,i=n,t=[],u=[],c=[],l=google.maps.geometry.spherical.computeArea(i.overlay.getPath());for(r=0;r<i.overlay.getPath().length;r++)t=i.overlay.getPath().getAt(r).toUrlValue(5).split(","),isNaN(t[0]*1)||isNaN(t[1]*1)||u.push(new google.maps.LatLng(t[0]*1,t[1]*1)),c.push(t);f.setMap(null);it(i);o=s(u,e.userData);h={area:l,polygonsArray:u,guid:o};tt(h,e.userData)})}function tt(n,t){var r={};r.polygonData=n;r.userData=t;i.callBack.polygonDrawnCallback(r)}function it(n){n&&n.overlay.setMap(null)}function rt(){i={mapData:[],enableInput:!0,defaultAddress:"Sweden",userDefaultAddress:null,infoWindow:null,polygons:[],callBack:{polygonDrawnCallback:null},mapFunctions:{updateExistingPolygon:l,updatePolygonColor:a,removePolygon:v,triggerMapResize:y,drawPolygon:nt}};n.googleMapModel&&(i.mapData=n.googleMapModel.mapData?angular.extend(n.googleMapModel.mapData):n.googleMapModel.mapData,i.enableInput=angular.isDefined(n.googleMapModel.enableInput)&&n.googleMapModel.enableInput===undefined?i.enableInput:n.googleMapModel.enableInput,i.callBack.polygonDrawnCallback=n.googleMapModel.callBack&&n.googleMapModel.callBack.polygonDrawnCallback?n.googleMapModel.callBack.polygonDrawnCallback:null,i.userDefaultAddress=!angular.isDefined(n.googleMapModel.userDefaultAddress)||n.googleMapModel.userDefaultAddress!=undefined?n.googleMapModel.userDefaultAddress:i.userDefaultAddress);n.googleMapModel||(n.googleMapModel={});n.googleMapModel.mapData=i.mapData;n.googleMapModel.enableInput=i.enableInput;n.googleMapModel.callBack=i.callBack;n.googleMapModel.mapFunctions=i.mapFunctions;n.googleMapModel.userDefaultAddress=i.userDefaultAddress}var i=null,o=null,r=null,f=null,u=null,r=null,e=null;if(t&&(!t||t[0]))o=t[0];else{console.error("No valid elements found");return}rt();h();p();c()}}}]);